<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Multi-Agent System</title>
    <!-- åŸæœ‰çš„ style å†…å®¹ä¿æŒä¸å˜ -->
    <style>
        /* å¤åˆ¶åŸæœ‰çš„æ‰€æœ‰æ ·å¼å†…å®¹ */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
            line-height: 1.6;
        }
        /* ... å…¶ä»–æ ·å¼å†…å®¹ ... */
    </style>
</head>
<body>
    <div class="container">
        <h1>YouTube Multi-Agent System</h1>

        <!-- API Lock Controls -->
        <div class="api-lock-section" style="text-align: center; margin-bottom: 20px;">
            <button id="apiLockButton" onclick="toggleApiLock()" class="api-lock-button">
                <span id="lockIcon">ğŸ”“</span> API å·²è§£é”
            </button>
            <div id="apiLockStatus" style="margin-top: 10px; font-style: italic; color: #666;"></div>
        </div>

        <button class="full-workflow-button" onclick="runFullWorkflow()">è¿è¡Œå®Œæ•´å·¥ä½œæµ (Strategy â†’ Research â†’ Script â†’ Review â†’ Editor)</button>

        <hr style="margin: 40px 0;">

        <!-- Strategy Agent Section -->
        <div class="agent-section" id="strategy-section">
            <h2>1. ç­–ç•¥ç”Ÿæˆ (Strategy Agent)</h2>
            <label for="strategyTopic">ä¸»é¢˜:</label>
            <input type="text" id="strategyTopic" placeholder="ä¾‹å¦‚ï¼šäººå·¥æ™ºèƒ½å‘å±•è¶‹åŠ¿" value="äººå·¥æ™ºèƒ½å‘å±•è¶‹åŠ¿">

            <label for="strategyTimeRange">æ—¶é—´èŒƒå›´:</label>
            <select id="strategyTimeRange" style="margin-bottom: 15px;">
                <option value="MONTHS_3">è¿‘3ä¸ªæœˆ</option>
                <option value="YEAR_1">è¿‘1å¹´</option>
                <option value="YEARS_2">è¿‘2å¹´</option>
            </select>

            <label for="strategySource">é€‰é¢˜æ¥æº:</label>
            <select id="strategySource" onchange="handleSourceChange()">
                <option value="news">æ–°é—»ç½‘ç«™ (NewsAPI)</option>
                <option value="youtube">YouTube è¶‹åŠ¿è§†é¢‘</option>
            </select>

            <!-- åŸæœ‰çš„å…¶ä»–å†…å®¹å’Œè¡¨å•å…ƒç´ ä¿æŒä¸å˜ -->
            <!-- ... -->

            <button onclick="runStrategy()">ç”Ÿæˆé€‰é¢˜ç­–ç•¥</button>
            <div id="strategyLoading" class="loading" style="display: none;">æ­£åœ¨ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™...</div>
            <div class="output-container">
                <div id="strategyOutput" class="output-area"></div>
                <button class="copy-button" onclick="copyText('strategyOutput')">å¤åˆ¶</button>
            </div>
        </div>

        <!-- å…¶ä»–éƒ¨åˆ†ï¼ˆResearch Agentã€Scriptwriter Agentç­‰ï¼‰ä¿æŒä¸å˜ -->
        <!-- ... -->

    </div>

    <script>
        const API_BASE_URL = 'http://127.0.0.1:8000';

        // ä¿ç•™åŸæœ‰çš„æ‰€æœ‰JavaScriptå‡½æ•°å’Œä»£ç 
        // æ›´æ–° runStrategy å‡½æ•°ä»¥åŒ…å«æ—¶é—´èŒƒå›´å‚æ•°
        async function runStrategy() {
            showLoading('strategyLoading');
            setOutput('strategyOutput', '');
            try {
                const topic = document.getElementById('strategyTopic').value.trim();
                if (!topic) {
                    throw new Error('è¯·è¾“å…¥ä¸»é¢˜');
                }

                const source = document.getElementById('strategySource').value;
                const timeRange = document.getElementById('strategyTimeRange').value;
                let requestBody = { 
                    topic: topic, 
                    source: source,
                    time_range: timeRange
                };

                // å…¶ä»–å‚æ•°å¤„ç†ä¿æŒä¸å˜
                if (source === 'news') {
                    // ... news source ç›¸å…³ä»£ç  ...
                } else {
                    // ... youtube source ç›¸å…³ä»£ç  ...
                }

                console.log(`[Strategy] Source: ${source}, Time Range: ${timeRange}`);

                const apiLockStatus = await checkApiLockStatus();
                if (apiLockStatus) {
                    throw new Error('API å½“å‰å¤„äºé”å®šçŠ¶æ€ï¼Œè¯·å…ˆè§£é”');
                }

                const data = await callApi('/strategy', 'POST', requestBody);
                currentStrategyRecommendation = data.recommendation;
                setOutput('strategyOutput', currentStrategyRecommendation);
                document.getElementById('researchQuery').value = `è¯·æ ¹æ®ä»¥ä¸‹é€‰é¢˜å»ºè®®ç”Ÿæˆç ”ç©¶æŠ¥å‘Šï¼š\n${currentStrategyRecommendation.split('\n')[0]}`;
                document.getElementById('scriptTopicTitle').value = currentStrategyRecommendation.split('\n')[0].replace('1. æ ‡é¢˜å»ºè®®ï¼š', '').trim();
            } catch (error) {
                setOutput('strategyOutput', `é”™è¯¯: ${error.message}`);
            } finally {
                hideLoading('strategyLoading');
            }
        }

        // å…¶ä»–åŸæœ‰çš„JavaScriptå‡½æ•°ä¿æŒä¸å˜
        // ...

    </script>
</body>
</html>
