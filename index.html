<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Multi-Agent System</title>
    <!-- 原有的 style 内容保持不变 -->
    <style>
        /* 复制原有的所有样式内容 */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
            line-height: 1.6;
        }
        /* ... 其他样式内容 ... */
    </style>
</head>
<body>
    <div class="container">
        <h1>YouTube Multi-Agent System</h1>

        <!-- API Lock Controls -->
        <div class="api-lock-section" style="text-align: center; margin-bottom: 20px;">
            <button id="apiLockButton" onclick="toggleApiLock()" class="api-lock-button">
                <span id="lockIcon">🔓</span> API 已解锁
            </button>
            <div id="apiLockStatus" style="margin-top: 10px; font-style: italic; color: #666;"></div>
        </div>

        <button class="full-workflow-button" onclick="runFullWorkflow()">运行完整工作流 (Strategy → Research → Script → Review → Editor)</button>

        <hr style="margin: 40px 0;">

        <!-- Strategy Agent Section -->
        <div class="agent-section" id="strategy-section">
            <h2>1. 策略生成 (Strategy Agent)</h2>
            <label for="strategyTopic">主题:</label>
            <input type="text" id="strategyTopic" placeholder="例如：人工智能发展趋势" value="人工智能发展趋势">

            <label for="strategyTimeRange">时间范围:</label>
            <select id="strategyTimeRange" style="margin-bottom: 15px;">
                <option value="MONTHS_3">近3个月</option>
                <option value="YEAR_1">近1年</option>
                <option value="YEARS_2">近2年</option>
            </select>

            <label for="strategySource">选题来源:</label>
            <select id="strategySource" onchange="handleSourceChange()">
                <option value="news">新闻网站 (NewsAPI)</option>
                <option value="youtube">YouTube 趋势视频</option>
            </select>

            <!-- 原有的其他内容和表单元素保持不变 -->
            <!-- ... -->

            <button onclick="runStrategy()">生成选题策略</button>
            <div id="strategyLoading" class="loading" style="display: none;">正在生成中，请稍候...</div>
            <div class="output-container">
                <div id="strategyOutput" class="output-area"></div>
                <button class="copy-button" onclick="copyText('strategyOutput')">复制</button>
            </div>
        </div>

        <!-- 其他部分（Research Agent、Scriptwriter Agent等）保持不变 -->
        <!-- ... -->

    </div>

    <script>
        const API_BASE_URL = 'http://127.0.0.1:8000';

        // 保留原有的所有JavaScript函数和代码
        // 更新 runStrategy 函数以包含时间范围参数
        async function runStrategy() {
            showLoading('strategyLoading');
            setOutput('strategyOutput', '');
            try {
                const topic = document.getElementById('strategyTopic').value.trim();
                if (!topic) {
                    throw new Error('请输入主题');
                }

                const source = document.getElementById('strategySource').value;
                const timeRange = document.getElementById('strategyTimeRange').value;
                let requestBody = { 
                    topic: topic, 
                    source: source,
                    time_range: timeRange
                };

                // 其他参数处理保持不变
                if (source === 'news') {
                    // ... news source 相关代码 ...
                } else {
                    // ... youtube source 相关代码 ...
                }

                console.log(`[Strategy] Source: ${source}, Time Range: ${timeRange}`);

                const apiLockStatus = await checkApiLockStatus();
                if (apiLockStatus) {
                    throw new Error('API 当前处于锁定状态，请先解锁');
                }

                const data = await callApi('/strategy', 'POST', requestBody);
                currentStrategyRecommendation = data.recommendation;
                setOutput('strategyOutput', currentStrategyRecommendation);
                document.getElementById('researchQuery').value = `请根据以下选题建议生成研究报告：\n${currentStrategyRecommendation.split('\n')[0]}`;
                document.getElementById('scriptTopicTitle').value = currentStrategyRecommendation.split('\n')[0].replace('1. 标题建议：', '').trim();
            } catch (error) {
                setOutput('strategyOutput', `错误: ${error.message}`);
            } finally {
                hideLoading('strategyLoading');
            }
        }

        // 其他原有的JavaScript函数保持不变
        // ...

    </script>
</body>
</html>
